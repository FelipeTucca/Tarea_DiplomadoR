---
title: "Analisis exploratorio datos"
author: "Felipe Tucca"
date: '2022-05-03'
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE)

library(readxl)
library(stats)
library(MASS)
library(Rlab)
library(ggplot2)
library(psych)
library(kableExtra)
library(knitr)
library(DT)
library(pander)
library(tidyverse)
library(dplyr)
library(tidyr)

```

## ***Análisis exploratorio de datos***

# **Análisis preliminar de datos**

Ajuste previo de la información presente en la planilla "mortalidad" donde se realizó transformación de datos mediante as.factor, colapso de columnas con la función gather creándose nuevas columnas "causa" - "muertos" y filtrar valores cero. Finalmente se realizó un resumen de una nueva planilla llamada "Mortalidad1" para el trabajo posterior solicitado en la Pauta de trabajo.

```{r resumen, echo=TRUE}
summary(Mortalidad)
```

# *Transformación de datos mediante as.factor*

```{r transformación datos, echo=TRUE}
Mortalidad$centro_id <- as.factor(Mortalidad$centro_id)
Mortalidad$año <- as.factor(Mortalidad$año)
Mortalidad$mes <- as.factor(Mortalidad$mes)
Mortalidad$Semana <- as.factor(Mortalidad$Semana)
```

```{r resumen con factores modificados, echo=TRUE}
summary(Mortalidad)
```

# *Ordenar datos con gather() y filtrar valores cero de la base de datos*

```{r ordenar datos con gather, echo=TRUE}
Mortalidad1 <- gather(Mortalidad,"Causa", "Muertos", 7:8 ) %>% filter(Muertos > 0)
```

```{r resumen, echo=TRUE}
summary(Mortalidad1)
```
```{r transformación datos, echo=TRUE}
Mortalidad1$Causa <- as.factor(Mortalidad1$Causa)
```

# *Resumen*

```{r resumen, echo=TRUE}
summary(Mortalidad1)
```


## **Variación de la variable en estudio mediante histogramas**

## *Histograma 1*

```{r histograma 1 peces muertos, echo=TRUE}
ggplot(Mortalidad1, aes(Muertos)) + 
  geom_histogram(bins = 30, color = "red", fill = "blue")+ 
  labs(title="Histograma peces muertos", x="Muertos", y="Frecuencia") 
```

# *Transformación log con función mutate ()*

```{r histograma 1 datos transformado log de peces muertos, echo=TRUE}
Mortalidad1 %>% mutate(log_Muertos= log(Muertos)) %>% ggplot(aes(log_Muertos)) + 
  geom_histogram(bins = 20, color = "red", fill = "blue")+ labs(title="Histograma peces muertos", x="Log Muertos", y="Frecuencia")
```

```{r histograma 1 datos transformado log de biomasa muerta, echo=TRUE}
Mortalidad1 %>% mutate(Biomasa_ton= (Peso_g * Muertos)/1000000) %>% mutate(log_biomasa= log(Biomasa_ton)) %>% ggplot(aes(log_biomasa)) + 
  geom_histogram(bins = 40, color = "yellow", fill = "green")+ labs(title="Histograma biomasa muerta (ton)", x="Log biomasa", y="Frecuencia")
```
## *Histograma 2*



```{r histograma 2, echo=TRUE}
ggplot(Mortalidad1, aes(Muertos))+geom_histogram(bins = 20, aes(color= Causa))+
  aes(position = "identity", bins =20, alpha = 0.3)
```

# *Transformación log con función mutate ()*

# *_Histograma log_Muertos y causa de mortalidad_*

```{r histograma 2 datos transformados log peces muertos y causa de mortalidad, echo=TRUE}
Mortalidad1 %>% mutate(log_Muertos= log(Muertos)) %>% ggplot(aes(log_Muertos))+ geom_histogram(bins = 30, aes(color= Causa))+
  aes(position = "identity", bins =20, alpha = 0.4)
```

# *_Histograma log_Biomasa muerta (toneladas) y causa de mortalidad_*

```{r histograma 2 datos transformados log biomasa muerta y causa de mortalidad, echo=TRUE}
Mortalidad1 %>% mutate(Biomasa_ton= (Peso_g * Muertos)/1000000) %>% mutate(log_biomasa= log(Biomasa_ton)) %>% ggplot(aes(log_biomasa))+ geom_histogram(bins = 40, aes(color= Causa))+
  aes(position = "identity", bins =30, alpha = 0.4)

```

# **Tablas de frecuencia**

Para la base de datos se observa que la causa de mortalidad en salmon del Atlántico no esta balanceada, registrándose un mayor número de muertos por la variable oxígeno disuelto (864 muertos). En definitiva, existe mayor cantidad de observaciones por causa de muerte por OD que bloom de algas, lo que genera el desbalance de los datos.

```{r balance de datos Causa, echo=TRUE}
table(Mortalidad1$Causa)
```

Por otro lado, de acuerdo al registro de mortalidades por centro se observa que 4 centros registran históricamente un número mayor a 100 eventos por mortalidad provocadas por la acción de bloom de algas y disminución de oxígeno disuelto.

```{r balance de datos centro_id, echo=TRUE}
table(Mortalidad1$centro_id)
```

Para el barrio en estudio el mayor número de registros históricos de peces muertos se encuentran durante los años 2015, 2019 y 2021, siendo mayoritariamente reportados durante otoño (mes 3 - mes 4 - mes 5) y primavera (mes 10 - mes 11). 

```{r balance de datos tiempo, echo=TRUE}
table(Mortalidad1$año)
table(Mortalidad1$mes)
```

# *Gráficas*

# _Boxplot_

```{r boxplot, echo=TRUE}
Mortalidad1 %>% mutate(Biomasa_ton= (Peso_g * Muertos)/1000000) %>% mutate(log_Muertos= log(Muertos)) %>% ggplot(aes(x= año, y= log_Muertos, fill= Causa)) + geom_boxplot()
```


```{r interacción- de datos, echo=TRUE}
Mortalidad1 %>% ggplot(aes(x=Causa, y=Muertos, color=Causa))+
  geom_point(size=2) + labs(x= "Causa", y= "Número de muertos")+
  theme_gray()

```

